<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Угадай звук</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; padding: 20px; margin: 0; background: #1a1a1a; color: #fff; min-height: 100vh; }
    h1 { font-size: 1.5rem; margin: 0 0 20px; }
    p { margin: 0 0 16px; }
    .keys { display: flex; gap: 12px; flex-wrap: wrap; margin: 20px 0; }
    .key { width: 48px; height: 48px; font-size: 1.2rem; font-weight: bold; border: 2px solid #0066cc; background: #333; color: #fff; border-radius: 8px; cursor: pointer; }
    .key:hover, .key:focus { background: #0066cc; outline: none; }
    .key:focus-visible { outline: 3px solid #fff; outline-offset: 2px; }
    .status { margin-top: 24px; font-size: 1.1rem; min-height: 1.5em; }
    .start { padding: 12px 24px; font-size: 1rem; background: #0a0; color: #fff; border: none; border-radius: 8px; cursor: pointer; }
    .start:hover, .start:focus { background: #080; }
    .start:focus-visible { outline: 3px solid #fff; outline-offset: 2px; }
  </style>
</head>
<body>
  <h1>Угадай звук</h1>
  <p>Нажмите кнопку "Слушать" - прозвучит один из пяти тонов. Затем нажмите клавишу 1, 2, 3, 4 или 5, которая ему соответствует.</p>
  <button type="button" class="start" id="playBtn">Слушать</button>
  <p>Ваш ответ (клавиши 1-5):</p>
  <div class="keys" role="group" aria-label="Выбор ноты">
    <button type="button" class="key" id="k1" data-note="1">1</button>
    <button type="button" class="key" id="k2" data-note="2">2</button>
    <button type="button" class="key" id="k3" data-note="3">3</button>
    <button type="button" class="key" id="k4" data-note="4">4</button>
    <button type="button" class="key" id="k5" data-note="5">5</button>
  </div>
  <p class="status" id="status" aria-live="polite">Нажмите "Слушать", чтобы начать раунд.</p>
  <script>
    var audioCtx = null;
    function getCtx() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      return audioCtx;
    }
    function playTone(note) {
      var ctx = getCtx();
      var o = ctx.createOscillator();
      var g = ctx.createGain();
      o.connect(g);
      g.connect(ctx.destination);
      o.frequency.value = 200 + note * 80;
      o.type = 'sine';
      g.gain.setValueAtTime(0.2, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime + 0.3);
    }
    var currentNote = 0;
    var statusEl = document.getElementById('status');
    var playBtn = document.getElementById('playBtn');
    function newRound() {
      currentNote = 1 + Math.floor(Math.random() * 5);
      statusEl.textContent = 'Слушайте...';
      playTone(currentNote);
      setTimeout(function() {
        statusEl.textContent = 'Нажмите клавишу 1, 2, 3, 4 или 5.';
      }, 400);
    }
    function check(guess) {
      if (currentNote === 0) return;
      if (guess === currentNote) {
        statusEl.textContent = 'Верно! Нажмите "Слушать" для следующего раунда.';
        currentNote = 0;
      } else {
        statusEl.textContent = 'Неверно. Попробуйте еще раз (1-5).';
      }
    }
    playBtn.addEventListener('click', newRound);
    [1,2,3,4,5].forEach(function(n) {
      document.getElementById('k' + n).addEventListener('click', function() { check(n); });
    });
    document.addEventListener('keydown', function(e) {
      if (e.key >= '1' && e.key <= '5') {
        e.preventDefault();
        check(parseInt(e.key, 10));
      }
      if (e.key === ' ') {
        e.preventDefault();
        if (currentNote === 0) newRound();
      }
    });
  </script>
</body>
</html>
